"use strict";angular.module("TweetReaderApp",["restangular","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).filter("parseUrl",function(){return function(a){return a.replace(/(https?:\/\/[^\s]+)/gi,'<a href="$1">$1</a>')}}).filter("parseUrlFilter",function(){var a=/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/gi;return function(b,c){return angular.forEach(b.match(a),function(a){b=b.replace(a,'<a target="'+c+'" href='+a+">"+a+"</a>")}),b}}).service("Tweets",["Restangular",function(a){var b={tweets:[]},c={get:function(){return b},refresh:function(){console.log("refreshing tweets"),b.tweets=a.all("tweets").getList({read:!1}),b.tweets.then(function(a){console.log("fetched "+a.length+" tweets")})},create:function(b){console.log("creating tweet: "+b),a.all("tweets").post({text:b})}};return c.refresh(),c}]),angular.module("TweetReaderApp").controller("MainCtrl",["$scope","Tweets",function(a,b){a.data=b.get(),a.markAsRead=function(a){a.metadata.read=!a.metadata.read,a.put()},a.getReadLabel=function(a){return a.metadata.read?"Mark as unread":"Mark as read"},a.retweet=function(a){a.metadata.retweeted=!0,a.metadata.read=!0,a.metadata.interesting=!0,a.put()},a.retweetAsRT=function(a){a.metadata.interesting=!0,a.metadata.read=!0,a.put(),b.create("RT @"+a.twitterData.user.pseudo+" "+a.twitterData.text)}}]).controller("LoginCtrl",["$scope","$http","Restangular","localStorageService","Tweets",function(a,b,c,d,e){function f(){console.log("checking login"),d.set("serverUrl",a.serverUrl),d.set("authToken",a.authToken),b({method:"GET",url:a.serverUrl,params:{auth_token:a.authToken}}).success(function(){c.setBaseUrl(a.serverUrl),c.setDefaultRequestParams({auth_token:a.authToken}),e.refresh(),a.isLoggedIn=!0}).error(function(){a.isLoggedIn=!1})}a.isLoggedIn=!1,a.serverUrl=d.get("serverUrl")||"/url",a.authToken=d.get("authToken")||"auth token",a.checkLogin=f,a.loginOpts={backdropFade:!0,dialogFade:!0,backdropClick:!1},f()}]);